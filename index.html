<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Environmental Data Visualizations</title>
    <!-- Add D3.js for chart creation -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .tooltip {
            position: absolute;
            background-color: white;
            border: 1px solid black;
            border-radius: 5px;
            padding: 5px;
            visibility: hidden;
        }
        .bar {
            fill-opacity: 0.7;
        }
        .axis-label {
            font-size: 14px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Homepage title and subtitle -->
    <h1>Global Environmental Data Visualizations</h1>
    <h2>Assignment 1 - Dario Onsori</h2>

    <!-- Project information section -->
    <section>
        <h3>About the Project</h3>
        <p>This project presents interactive visualizations of global CO₂ emissions data. The visualizations aim to provide insights into the per capita emissions, regional comparisons, and types of CO₂ sources.</p>
    </section>

    <!-- Section for displaying annual or decade average emissions with selectors -->
    <section id="comparing-categories">
        <h3>Per Capita CO₂ Emissions Comparison</h3>

        <!-- Selector for choosing between year and decade -->
        <label for="time-period">Select Time Period:</label>
        <select id="time-period">
            <option value="2018">Year: 2018</option>
            <option value="decade">Decade: 2010-2020 (Average)</option>
        </select>

        <!-- Container for the bar chart -->
        <div id="bar-chart"></div>
        
        <!-- Button to toggle sorting -->
        <div style="margin-top: 10px;">
            <button onclick="sortBars()">Sort by Emissions</button>
        </div>
    </section>

    <!-- New Section for Country Comparison -->
    <section id="country-comparison">
        <h3>Country Comparison: CO₂ Emissions by Region</h3>
        <div id="stacked-bar-chart"></div>
    </section>

    <!-- Tooltip for mouseover display -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Data for the Country Comparison chart
        const regionData = [
            {
                region: "Africa",
                countries: {
                    "South Africa": 7.59,
                    "Nigeria": 0.53,
                    "Egypt": 2.35,
                    "Algeria": 4.08,
                    "Morocco": 1.73,
                    "Others": 10.34
                }
            },
            {
                region: "Asia",
                countries: {
                    "China": 7.30,
                    "India": 1.89,
                    "Japan": 9.04,
                    "South Korea": 12.97,
                    "Indonesia": 2.22,
                    "Others": 15.13
                }
            },
            {
                region: "Europe",
                countries: {
                    "Germany": 9.10,
                    "France": 5.01,
                    "United Kingdom": 5.71,
                    "Italy": 5.84,
                    "Spain": 5.74,
                    "Others": 8.57
                }
            },
            {
                region: "North America",
                countries: {
                    "United States": 16.19,
                    "Canada": 15.58,
                    "Mexico": 3.79,
                    "Others": 5.92
                }
            },
            {
                region: "South America",
                countries: {
                    "Brazil": 2.27,
                    "Argentina": 4.07,
                    "Colombia": 1.77,
                    "Chile": 4.51,
                    "Peru": 1.73,
                    "Others": 3.42
                }
            },
            {
                region: "Oceania",
                countries: {
                    "Australia": 16.62,
                    "New Zealand": 7.38,
                    "Papua New Guinea": 0.81,
                    "Others": 2.43
                }
            }
        ];

        // Tooltip setup
        const tooltip = d3.select("#tooltip");

        function createStackedBarChart(data) {
            // Clear any existing SVG
            d3.select("#stacked-bar-chart").selectAll("*").remove();

            // Chart settings
            const width = 800;
            const height = 400;
            const margin = { top: 20, right: 30, bottom: 100, left: 50 };

            // Create SVG
            const svg = d3.select("#stacked-bar-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${margin.left}, ${margin.top})`);

            // Process data for stacking
            const regions = data.map(d => d.region);
            const categories = Object.keys(data[0].countries);

            // Color scale
            const color = d3.scaleOrdinal()
                .domain(categories)
                .range(d3.schemeCategory10);

            // Stack data
            const stackedSeries = d3.stack()
                .keys(categories)
                .value((d, key) => d.countries[key])
                (data);

            // X and Y scales
            const x = d3.scaleBand()
                .domain(regions)
                .range([0, width - margin.left - margin.right])
                .padding(0.2);

            const y = d3.scaleLinear()
                .domain([0, d3.max(stackedSeries, d => d3.max(d, d => d[1]))])
                .nice()
                .range([height - margin.top - margin.bottom, 0]);

            // X Axis
            svg.append("g")
                .attr("transform", `translate(0,${height - margin.top - margin.bottom})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "rotate(-45)")
                .style("text-anchor", "end");

            // Y Axis
            svg.append("g")
                .call(d3.axisLeft(y).ticks(10));

            // Create stacked bars
            svg.selectAll("g.layer")
                .data(stackedSeries)
                .enter().append("g")
                .attr("class", "layer")
                .attr("fill", d => color(d.key))
                .selectAll("rect")
                .data(d => d)
                .enter().append("rect")
                .attr("x", d => x(d.data.region))
                .attr("y", d => y(d[1]))
                .attr("height", d => y(d[0]) - y(d[1]))
                .attr("width", x.bandwidth())
                .on("mouseover", function(event, d) {
                    tooltip.style("visibility", "visible")
                           .html(`Region: ${d.data.region}<br>Emissions: ${(d[1] - d[0]).toFixed(2)}t`);
                })
                .on("mousemove", function(event) {
                    tooltip.style("top", `${event.pageY - 10}px`)
                           .style("left", `${event.pageX + 10}px`);
                })
                .on("mouseout", function() {
                    tooltip.style("visibility", "hidden");
                });
        }

        // Create the initial stacked bar chart
        createStackedBarChart(regionData);
    </script>
</body>
</html>
