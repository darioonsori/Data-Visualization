<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Environmental Data Visualizations</title>
    <!-- Add D3.js for chart creation -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .tooltip {
            position: absolute;
            background-color: white;
            border: 1px solid black;
            border-radius: 5px;
            padding: 5px;
            visibility: hidden;
        }
    </style>
</head>
<body>
    <!-- Homepage title and subtitle -->
    <h1>Global Environmental Data Visualizations</h1>
    <h2>Assignment 1 - Dario Onsori</h2>

    <!-- Project information section -->
    <section>
        <h3>About the Project</h3>
        <p>This project presents interactive visualizations of global CO2 emissions data. The visualizations aim to provide insights into the per capita emissions, regional comparisons, and types of CO2 sources.</p>
    </section>

    <!-- Section for displaying annual or decade average emissions with selectors -->
    <section id="comparing-categories">
        <h3>Per Capita CO2 Emissions Comparison</h3>

        <!-- Selector for choosing between year and decade -->
        <label for="time-period">Select Time Period:</label>
        <select id="time-period">
            <option value="2018">Year: 2018</option>
            <option value="decade">Decade: 2010-2020 (Average)</option>
        </select>

        <!-- Container for the bar chart -->
        <div id="bar-chart"></div>
        
        <!-- Button to toggle sorting -->
        <div style="margin-top: 10px;">
            <button onclick="sortBars()">Sort by Emissions</button>
        </div>
    </section>

    <!-- Country Comparison Section -->
    <section id="country-comparison">
        <h3>Country Comparison</h3>
        <p>This section compares CO2 emissions per capita across different regions, highlighting the top 5 countries and an aggregated "Other" category for each region.</p>
        
        <!-- Container for stacked bar chart -->
        <div id="stacked-bar-chart"></div>
    </section>

    <!-- Tooltip for mouseover display -->
    <div class="tooltip" id="tooltip"></div>

    <!-- Script for stacked bar chart -->
    <script>
        // Sample data for the stacked bar chart (replace this with your processed data)
        const stackedData = [
            { Region: "Africa", Country: "Libya", Emissions: 8.339181 },
            { Region: "Africa", Country: "South Africa", Emissions: 7.590512 },
            { Region: "Africa", Country: "Seychelles", Emissions: 5.827153 },
            { Region: "Africa", Country: "Algeria", Emissions: 4.085100 },
            { Region: "Africa", Country: "Equatorial Guinea", Emissions: 4.000027 },
            { Region: "Africa", Country: "Other", Emissions: 31.802244 },
            // Add other regions and countries here
        ];

        // Chart settings
        const margin = { top: 20, right: 30, bottom: 40, left: 50 };
        const width = 800 - margin.left - margin.right;
        const height = 400 - margin.top - margin.bottom;

        // SVG container
        const svg = d3.select("#stacked-bar-chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left}, ${margin.top})`);

        // X and Y scales
        const xScale = d3.scaleBand()
            .domain(stackedData.map(d => d.Region))
            .range([0, width])
            .padding(0.2);

        const yScale = d3.scaleLinear()
            .domain([0, d3.max(stackedData, d => d.Emissions)])
            .range([height, 0]);

        // Color scale
        const colorScale = d3.scaleOrdinal(d3.schemeTableau10);

        // Stack data by Region
        const regions = d3.group(stackedData, d => d.Region);
        let processedData = [];
        regions.forEach((values, key) => {
            let total = 0;
            values.forEach(d => {
                processedData.push({ region: key, country: d.Country, emissions: d.Emissions, start: total });
                total += d.Emissions;
            });
        });

        // Draw bars
        svg.selectAll(".bar")
            .data(processedData)
            .enter()
            .append("rect")
            .attr("class", "bar")
            .attr("x", d => xScale(d.region))
            .attr("y", d => yScale(d.start + d.emissions))
            .attr("width", xScale.bandwidth())
            .attr("height", d => height - yScale(d.emissions))
            .attr("fill", d => colorScale(d.country))
            .on("mouseover", function(event, d) {
                d3.select("#tooltip")
                    .style("visibility", "visible")
                    .text(`${d.country}: ${d.emissions.toFixed(2)} t`);
            })
            .on("mousemove", function(event) {
                d3.select("#tooltip")
                    .style("top", `${event.pageY - 10}px`)
                    .style("left", `${event.pageX + 10}px`);
            })
            .on("mouseout", function() {
                d3.select("#tooltip").style("visibility", "hidden");
            });

        // X-axis
        svg.append("g")
            .attr("transform", `translate(0, ${height})`)
            .call(d3.axisBottom(xScale));

        // Y-axis
        svg.append("g")
            .call(d3.axisLeft(yScale).ticks(5));
    </script>
</body>
</html>
